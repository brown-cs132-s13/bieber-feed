<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <title>Bieber Feed Ajax Test</title>
</head>
<body>
  <div id="tweets">
    <ul id="tweet-list">
    </ul>
    <button onclick="start()">start</button>
    <button onclick="stop()">stop</button>
  </div>
  <script type="text/javascript" charset="utf-8">
    function pollBieber () {
      var request = new XMLHttpRequest();
      request.open('GET', 'http://localhost:1337/feed/test', true);
      request.send();
      request.onreadystatechange = function () {
        var state = request.readyState;
        if (state === 4) {
          if (request.status === 200) {
            done(request.responseText);
          } else {
            alert(request.status);
            console.log(request);
          }
        }
      }

      var list = document.getElementById('tweet-list');

      function done(data) {
        if (!data) {
          alert("no data");
          return console.log(request);
        }

        data = JSON.parse(data);
        var i = 0, l = data.length, frag = '';

        for (; i < l; i++) {
          frag += "<li>" + data[i].text + "</li>";
        }

        list.innerHTML = frag;
      }
    }

    var polling = null;
    function start () {
      if (polling) {
        clearInterval(polling); 
      }
      polling = setInterval(pollBieber, 600);
    }

    function stop () {
      if (polling) {
        clearInterval(polling);
      }
    }

  </script>
</body>
</html>
